---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Pagination from '../../components/Pagination.vue';
import { getDefaultPluginsByType, type Plugin } from '../../lib/data';

const ITEMS_PER_PAGE = 100;

// Get all default transformers
const allPlugins = getDefaultPluginsByType('transformers')
  .filter((p) => !p.hidden)
  .sort((a, b) => (a.label_lowercase || a.name).localeCompare(b.label_lowercase || b.name));

// Pagination
const currentPage = 1;
const totalPages = Math.ceil(allPlugins.length / ITEMS_PER_PAGE);
const paginatedPlugins = allPlugins.slice(0, ITEMS_PER_PAGE);

function getPluginPath(plugin: Plugin): string {
  return plugin.path.split('--')[0];
}
---

<BaseLayout title="Transformers">
  <div class="w-full mx-auto plugins-overview max-w-7xl">
    <p class="pt-8 pb-4 text-3xl font-bold md:text-5xl font-pjs text-purple">Transformers</p>
    <div class="max-w-3xl mx-auto mb-4">
      <p class="mb-4">
        Transformers are plugins for running SQL-based transformations on data stored in your warehouse.
      </p>
      <p>
        To learn more about transformers, refer to the
        <a href="https://docs.meltano.com/concepts/plugins#transformers" target="_blank" class="underline"
          >Transformers documentation</a
        >.
      </p>
    </div>

    <!-- Plugin Grid -->
    <div
      class="grid w-full grid-cols-2 gap-4 p-4 mt-4 rounded-lg md:grid-cols-4 md:m-4 place-items-stretch"
      role="list"
    >
      {paginatedPlugins.map((plugin) => (
        <div class="h-48 p-2 overflow-hidden border rounded-md text-slate-800 hover:bg-white bg-white-07 md:p-4 border-purple/10">
          <a
            class="grid w-full h-40 grid-rows-6 align-self-center place-items-center"
            href={getPluginPath(plugin)}
          >
            <div class="grid w-full h-24 row-span-4 bg-white place-self-center">
              {plugin.logo_url && (
                <img
                  src={plugin.logo_url}
                  alt={plugin.label || plugin.name}
                  class="object-contain place-self-center max-w-[100px] max-h-[80px]"
                />
              )}
            </div>
            <div class="grid content-end self-stretch row-span-5">
              <p class="text-xs font-bold underline lg:text-md justify-self-center text-clip">
                {plugin.label || plugin.name}
              </p>
            </div>
          </a>
        </div>
      ))}

      {totalPages > 1 && (
        <Pagination
          client:load
          currentPage={currentPage}
          totalPages={totalPages}
          basePath="/transformers"
        />
      )}
    </div>
  </div>
</BaseLayout>
